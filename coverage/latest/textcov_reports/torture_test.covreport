
































LLVMFuzzerTestOneInput:
 1886|  2.68k|{
 1887|  2.68k|	lua_State *L = luaL_newstate();
 1888|  2.68k|	if (L == NULL)
  ------------------
  |  Branch (1888:6): [True: 0, False: 2.68k]
  ------------------
 1889|      0|		return 0;
 1890|       |
 1891|  2.68k|#if LUA_VERSION_NUM == 501
 1892|  2.68k|	luaL_register(L, TYPE_NAME_TORTURE, TORTURE_meta);
  ------------------
  |  |   43|  2.68k|#define TYPE_NAME_TORTURE "torture_test"
  ------------------
 1893|       |#else
 1894|       |	luaL_newmetatable(L, TYPE_NAME_TORTURE);
 1895|       |	luaL_setfuncs(L, TORTURE_meta, 0);
 1896|       |#endif /* LUA_VERSION_NUM */
 1897|       |
 1898|  2.68k|	FuzzedDataProvider fdp(data, size);
 1899|  2.68k|	int start_slots = 2;
 1900|  8.06k|	for (int i = 1; i <= start_slots; i++)
  ------------------
  |  Branch (1900:18): [True: 5.37k, False: 2.68k]
  ------------------
 1901|  5.37k|		if (fdp.remaining_bytes() != 0)
  ------------------
  |  Branch (1901:7): [True: 5.04k, False: 328]
  ------------------
 1902|  5.04k|			lua_pushrandom(L, &fdp);
 1903|       |
 1904|  2.68k|	if (lua_gettop(L) != 0 &&
  ------------------
  |  Branch (1904:6): [True: 2.68k, False: 0]
  ------------------
 1905|  2.68k|	    fdp.remaining_bytes() != 0) {
  ------------------
  |  Branch (1905:6): [True: 2.07k, False: 616]
  ------------------
 1906|  2.07k|		__lua_gc(L, &fdp);
 1907|  2.07k|		__lua_sethook(L, &fdp);
 1908|  2.07k|		uint8_t idx = fdp.ConsumeIntegralInRange<uint8_t>(0, (int)ARRAY_SIZE(func) - 1);
  ------------------
  |  |   33|  2.07k|#define ARRAY_SIZE(arr)     (sizeof(arr) / sizeof((arr)[0]))
  ------------------
 1909|  2.07k|		func[idx](L, &fdp);
 1910|  2.07k|	}
 1911|       |
 1912|  2.68k|	lua_settop(L, 0);
 1913|  2.68k|	lua_close(L);
 1914|       |
 1915|  2.68k|	return 0;
 1916|  2.68k|}
torture_test.cc:_ZL9cfunctionP9lua_State:
   38|    374|cfunction(lua_State *L) {
   39|    374|	lua_gettop(L);
   40|    374|	return 0;
   41|    374|}
torture_test.cc:_ZL14lua_pushrandomP9lua_StateP18FuzzedDataProvider:
 1721|  5.04k|{
 1722|  5.04k|	uint8_t idx = fdp->ConsumeIntegralInRange(0, (int)ARRAY_SIZE(push_func) - 1);
  ------------------
  |  |   33|  5.04k|#define ARRAY_SIZE(arr)     (sizeof(arr) / sizeof((arr)[0]))
  ------------------
 1723|  5.04k|	push_func[idx](L, fdp);
 1724|       |
 1725|  5.04k|	bool is_set_mt = fdp->ConsumeBool();
 1726|  5.04k|	if (is_set_mt) {
  ------------------
  |  Branch (1726:6): [True: 2.38k, False: 2.66k]
  ------------------
 1727|  2.38k|		luaL_getmetatable(L, TYPE_NAME_TORTURE);
 1728|  2.38k|		lua_setmetatable(L, -2);
 1729|  2.38k|	}
 1730|  5.04k|}
torture_test.cc:_ZL14__lua_newtableP9lua_StateP18FuzzedDataProvider:
  611|  1.04k|{
  612|  1.04k|	int top = lua_gettop(L);
  613|  1.04k|	lua_newtable(L);
  614|  1.04k|	assert(lua_gettop(L) == top + 1);
  615|  1.04k|}
torture_test.cc:_ZL15__lua_newthreadP9lua_StateP18FuzzedDataProvider:
  621|  1.13k|{
  622|  1.13k|	int top = lua_gettop(L);
  623|  1.13k|	lua_newthread(L);
  624|  1.13k|	assert(lua_gettop(L) == top + 1);
  625|  1.13k|}
torture_test.cc:_ZL17__lua_pushbooleanP9lua_StateP18FuzzedDataProvider:
   67|    220|{
   68|    220|	uint8_t n = fdp->ConsumeIntegral<uint8_t>();
   69|    220|	int top = lua_gettop(L);
   70|    220|	lua_pushboolean(L, n);
   71|    220|	assert(lua_gettop(L) == top + 1);
   72|    220|}
torture_test.cc:_ZL19__lua_pushcfunctionP9lua_StateP18FuzzedDataProvider:
  589|    878|{
  590|    878|	(void)fdp;
  591|    878|	int top = lua_gettop(L);
  592|    878|	lua_pushcfunction(L, cfunction);
  593|    878|	assert(lua_gettop(L) == top + 1);
  594|    878|}
torture_test.cc:_ZL17__lua_pushintegerP9lua_StateP18FuzzedDataProvider:
  260|    318|{
  261|    318|	int top = lua_gettop(L);
  262|    318|	uint8_t n = fdp->ConsumeIntegral<uint8_t>();
  263|    318|	lua_pushinteger(L, n);
  264|    318|	assert(lua_gettop(L) == top + 1);
  265|    318|}
torture_test.cc:_ZL17__lua_pushlstringP9lua_StateP18FuzzedDataProvider:
  271|    289|{
  272|    289|	int top = lua_gettop(L);
  273|    289|	auto str = fdp->ConsumeRandomLengthString(max_str_len);
  274|    289|	lua_pushlstring(L, str.c_str(), str.size());
  275|    289|	assert(lua_gettop(L) == top + 1);
  276|    289|}
torture_test.cc:_ZL13__lua_pushnilP9lua_StateP18FuzzedDataProvider:
  282|    484|{
  283|    484|	int top = lua_gettop(L);
  284|    484|	lua_pushnil(L);
  285|    484|	assert(lua_gettop(L) == top + 1);
  286|    484|}
torture_test.cc:_ZL16__lua_pushnumberP9lua_StateP18FuzzedDataProvider:
  292|    257|{
  293|    257|	int top = lua_gettop(L);
  294|    257|	uint8_t n = fdp->ConsumeIntegral<uint8_t>();
  295|    257|	lua_pushnumber(L, n);
  296|    257|	assert(lua_gettop(L) == top + 1);
  297|    257|}
torture_test.cc:_ZL16__lua_pushstringP9lua_StateP18FuzzedDataProvider:
   56|    601|{
   57|    601|	auto str = fdp->ConsumeRandomLengthString(max_str_len);
   58|    601|	int top = lua_gettop(L);
   59|    601|	lua_pushstring(L, str.c_str());
   60|    601|	assert(lua_gettop(L) == top + 1);
   61|    601|}
torture_test.cc:_ZL8__lua_gcP9lua_StateP18FuzzedDataProvider:
  662|  2.23k|{
  663|  2.23k|	int top = lua_gettop(L);
  664|  2.23k|	uint8_t idx = fdp->ConsumeIntegralInRange<uint8_t>(0, ARRAY_SIZE(gc_mode) - 1);
  ------------------
  |  |   33|  2.23k|#define ARRAY_SIZE(arr)     (sizeof(arr) / sizeof((arr)[0]))
  ------------------
  665|       |#if LUA_VERSION_NUM > 503
  666|       |	if (gc_mode[idx] == LUA_GCGEN) {
  667|       |		double minor_mult = 0.1;
  668|       |		double major_mult = 0.1;
  669|       |		lua_gc(L, LUA_GCGEN, minor_mult, major_mult);
  670|       |	} else if (gc_mode[idx] == LUA_GCINC) {
  671|       |		double pause = 0.1;
  672|       |		double step_mult = 0.1;
  673|       |		double step_size = 0.1;
  674|       |		lua_gc(L, LUA_GCINC, pause, step_mult, step_size);
  675|       |	} else
  676|       |		lua_gc(L, gc_mode[idx], 0);
  677|       |#else
  678|  2.23k|	lua_gc(L, gc_mode[idx], 0);
  679|  2.23k|#endif /* LUA_VERSION_NUM */
  680|  2.23k|	assert(lua_gettop(L) == top);
  681|  2.23k|}
torture_test.cc:_ZL13__lua_sethookP9lua_StateP18FuzzedDataProvider:
  702|  2.07k|{
  703|  2.07k|	int top = lua_gettop(L);
  704|  2.07k|	uint8_t idx = fdp->ConsumeIntegralInRange<uint8_t>(0, ARRAY_SIZE(hook_mode) - 1);
  ------------------
  |  |   33|  2.07k|#define ARRAY_SIZE(arr)     (sizeof(arr) / sizeof((arr)[0]))
  ------------------
  705|  2.07k|	lua_sethook(L, Hook, hook_mode[idx], 1);
  706|  2.07k|	assert(lua_gettop(L) == top);
  707|  2.07k|}
torture_test.cc:_ZL4HookP9lua_StateP9lua_Debug:
  693|     31|{
  694|     31|	(void)L;
  695|     31|	(void)ar;
  696|     31|}
torture_test.cc:_ZL10__lua_callP9lua_StateP18FuzzedDataProvider:
 1647|    368|{
 1648|    368|	int top = lua_gettop(L);
 1649|       |	/* Function to be called. */
 1650|    368|	lua_pushcfunction(L, cfunction);
 1651|    368|	int nargs = 0;
 1652|    368|	int nresults = 0;
 1653|    368|	lua_call(L, nargs, nresults);
 1654|    368|	assert(lua_gettop(L) == top + nresults - nargs);
 1655|    368|}
torture_test.cc:_ZL16__lua_checkstackP9lua_StateP18FuzzedDataProvider:
  124|    207|{
  125|    207|	uint8_t n = fdp->ConsumeIntegral<uint8_t>();
  126|    207|	int rc = lua_checkstack(L, n);
  127|    207|	assert(rc != 0);
  128|    207|}
torture_test.cc:_ZL12__lua_concatP9lua_StateP18FuzzedDataProvider:
  134|     26|{
  135|     26|	int top = lua_gettop(L);
  136|     26|	uint8_t n = fdp->ConsumeIntegralInRange<uint8_t>(0, top);
  137|     53|	for (int i = 1; i <= n; i++) {
  ------------------
  |  Branch (137:18): [True: 36, False: 17]
  ------------------
  138|     36|		int t = lua_type(L, -i);
  139|     36|		if (t != LUA_TNUMBER &&
  ------------------
  |  Branch (139:7): [True: 21, False: 15]
  ------------------
  140|     36|		    t != LUA_TSTRING)
  ------------------
  |  Branch (140:7): [True: 9, False: 12]
  ------------------
  141|      9|			return;
  142|     36|	}
  143|     17|	lua_concat(L, n);
  144|     17|	assert(lua_gettop(L) == top - n + 1);
  145|     17|}
torture_test.cc:_ZL17__lua_createtableP9lua_StateP18FuzzedDataProvider:
 1736|     27|{
 1737|     27|	int nrows = fdp->ConsumeIntegral<uint8_t>();
 1738|       |	/* XXX: Lua associative arrays. */
 1739|     27|	lua_createtable(L, nrows, 0);
 1740|  2.97k|	for (int i = 0; i < nrows; i++) {
  ------------------
  |  Branch (1740:18): [True: 2.94k, False: 27]
  ------------------
 1741|  2.94k|		lua_pushnumber(L, i);
 1742|  2.94k|		lua_rawseti(L, -2, i + 1);
 1743|  2.94k|	}
 1744|     27|	assert(lua_gettop(L) != 0);
 1745|     27|}
torture_test.cc:_ZL15__lua_getallocfP9lua_StateP18FuzzedDataProvider:
 1581|      6|{
 1582|      6|	int top = lua_gettop(L);
 1583|      6|	void *state;
 1584|      6|	lua_getallocf(L, &state);
 1585|      6|	assert(lua_gettop(L) == top);
 1586|      6|}
torture_test.cc:_ZL14__lua_getfieldP9lua_StateP18FuzzedDataProvider:
 1256|     21|{
 1257|     21|	int top = lua_gettop(L);
 1258|     21|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1259|     21|	if (lua_type(L, index) != LUA_TTABLE)
  ------------------
  |  Branch (1259:6): [True: 3, False: 18]
  ------------------
 1260|      3|		return;
 1261|     18|	auto k = fdp->ConsumeRemainingBytesAsString();
 1262|     18|	lua_getfield(L, index, k.c_str());
 1263|     18|	assert(lua_gettop(L) == top + 1);
 1264|     18|}
torture_test.cc:_ZL15__lua_getglobalP9lua_StateP18FuzzedDataProvider:
  447|      6|{
  448|      6|	auto name = fdp->ConsumeRandomLengthString(max_str_len);
  449|      6|	int top = lua_gettop(L);
  450|      6|	lua_getglobal(L, name.c_str());
  451|      6|	assert(lua_gettop(L) == top + 1);
  452|      6|}
torture_test.cc:_ZL13__lua_gethookP9lua_StateP18FuzzedDataProvider:
  713|      9|{
  714|      9|	int top = lua_gettop(L);
  715|      9|	lua_gethook(L);
  716|      9|	assert(lua_gettop(L) == top);
  717|      9|}
torture_test.cc:_ZL18__lua_gethookcountP9lua_StateP18FuzzedDataProvider:
  723|     10|{
  724|     10|	int top = lua_gettop(L);
  725|     10|	int hook_count = lua_gethookcount(L);
  726|     10|	assert(hook_count >= 0);
  727|      0|	assert(lua_gettop(L) == top);
  728|     10|}
torture_test.cc:_ZL17__lua_gethookmaskP9lua_StateP18FuzzedDataProvider:
  734|      5|{
  735|      5|	int top = lua_gettop(L);
  736|      5|	int hook_mask = lua_gethookmask(L);
  737|      5|	assert(hook_mask >= 0);
  738|      0|	assert(lua_gettop(L) == top);
  739|      5|}
torture_test.cc:_ZL13__lua_getinfoP9lua_StateP18FuzzedDataProvider:
  551|      6|{
  552|      6|	int top = lua_gettop(L);
  553|      6|	lua_Debug ar;
  554|      6|	lua_pushcfunction(L, cfunction);
  555|      6|	const char *what = ">nSltufLr";
  556|      6|	lua_getinfo(L, what, &ar);
  557|      6|	assert(lua_gettop(L) >= top - 1 &&
  558|      6|	       lua_gettop(L) <= top + 2);
  559|      6|}
torture_test.cc:_ZL18__lua_getmetatableP9lua_StateP18FuzzedDataProvider:
  600|      5|{
  601|      5|	int top = lua_gettop(L);
  602|      5|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  603|      5|	lua_getmetatable(L, index);
  604|      5|	assert(lua_gettop(L) - top <= 1);
  605|      5|}
torture_test.cc:_ZL14__lua_getstackP9lua_StateP18FuzzedDataProvider:
  565|     12|{
  566|     12|	int top = lua_gettop(L);
  567|     12|	int level = fdp->ConsumeIntegral<int8_t>();
  568|     12|	lua_Debug ar;
  569|     12|	lua_getstack(L, level, &ar);
  570|     12|	assert(lua_gettop(L) == top);
  571|     12|}
torture_test.cc:_ZL14__lua_gettableP9lua_StateP18FuzzedDataProvider:
 1049|      7|{
 1050|      7|	int top = lua_gettop(L);
 1051|      7|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1052|      7|	if (!lua_istable(L, index))
  ------------------
  |  Branch (1052:6): [True: 2, False: 5]
  ------------------
 1053|      2|		return;
 1054|      5|	uint8_t key = fdp->ConsumeIntegral<uint8_t>();
 1055|      5|	lua_pushnumber(L, key);
 1056|      5|	lua_gettable(L, index);
 1057|       |	/* XXX: Wrong number of elements. */
 1058|       |	/* assert(lua_gettop(L) == top); */
 1059|      5|}
torture_test.cc:_ZL12__lua_gettopP9lua_StateP18FuzzedDataProvider:
  151|      5|{
  152|      5|	int rc = lua_gettop(L);
  153|      5|	assert(rc >= 0);
  154|      5|}
torture_test.cc:_ZL16__lua_getupvalueP9lua_StateP18FuzzedDataProvider:
  470|      8|{
  471|      8|	int top = lua_gettop(L);
  472|      8|	int funcindex = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  473|      8|	int n = fdp->ConsumeIntegral<uint8_t>();
  474|      8|	lua_getupvalue(L, funcindex, n);
  475|      8|	assert(lua_gettop(L) == top || lua_gettop(L) == top + 1);
  476|      8|}
torture_test.cc:_ZL12__lua_insertP9lua_StateP18FuzzedDataProvider:
  160|      7|{
  161|      7|	int top = lua_gettop(L);
  162|      7|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  163|      7|	lua_insert(L, index);
  164|      7|	assert(lua_gettop(L) == top - 1 + 1);
  165|      7|}
torture_test.cc:_ZL15__lua_isbooleanP9lua_StateP18FuzzedDataProvider:
  171|      6|{
  172|      6|	int top = lua_gettop(L);
  173|      6|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  174|      6|	int rc = lua_isboolean(L, index);
  175|      6|	assert(rc == 0 || rc == 1);
  176|      6|}
torture_test.cc:_ZL17__lua_iscfunctionP9lua_StateP18FuzzedDataProvider:
  182|      6|{
  183|      6|	int top = lua_gettop(L);
  184|      6|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  185|      6|	int rc = lua_iscfunction(L, index);
  186|      6|	assert(rc == 0 || rc == 1);
  187|      6|}
torture_test.cc:_ZL16__lua_isfunctionP9lua_StateP18FuzzedDataProvider:
  193|      3|{
  194|      3|	int top = lua_gettop(L);
  195|      3|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  196|      3|	int rc = lua_isfunction(L, index);
  197|      3|	assert(rc == 0 || rc == 1);
  198|      3|}
torture_test.cc:_ZL21__lua_islightuserdataP9lua_StateP18FuzzedDataProvider:
  493|      4|{
  494|      4|	int top = lua_gettop(L);
  495|      4|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  496|      4|	int rc = lua_islightuserdata(L, index);
  497|      4|	assert(rc == 0 || rc == 1);
  498|      4|}
torture_test.cc:_ZL11__lua_isnilP9lua_StateP18FuzzedDataProvider:
  204|      5|{
  205|      5|	int top = lua_gettop(L);
  206|      5|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  207|      5|	int rc = lua_isnil(L, index);
  208|      5|	assert(rc == 0 || rc == 1);
  209|      5|}
torture_test.cc:_ZL12__lua_isnoneP9lua_StateP18FuzzedDataProvider:
  215|      7|{
  216|      7|	int top = lua_gettop(L);
  217|      7|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  218|      7|	int rc = lua_isnone(L, index);
  219|      7|	assert(rc == 0 || rc == 1);
  220|      0|	assert(lua_gettop(L) == top);
  221|      7|}
torture_test.cc:_ZL17__lua_isnoneornilP9lua_StateP18FuzzedDataProvider:
  227|      4|{
  228|      4|	int top = lua_gettop(L);
  229|      4|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  230|      4|	lua_isnoneornil(L, index);
  231|      4|	assert(lua_gettop(L) == top);
  232|      4|}
torture_test.cc:_ZL14__lua_isnumberP9lua_StateP18FuzzedDataProvider:
   89|      9|{
   90|      9|	int top = lua_gettop(L);
   91|      9|	uint8_t n = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
   92|      9|	lua_isnumber(L, n);
   93|      9|	assert(lua_gettop(L) == top);
   94|      9|}
torture_test.cc:_ZL14__lua_isstringP9lua_StateP18FuzzedDataProvider:
  238|      8|{
  239|      8|	int top = lua_gettop(L);
  240|      8|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  241|      8|	int rc = lua_isstring(L, index);
  242|      8|	assert(rc == 0 || rc == 1);
  243|      8|}
torture_test.cc:_ZL13__lua_istableP9lua_StateP18FuzzedDataProvider:
  249|      4|{
  250|      4|	int top = lua_gettop(L);
  251|      4|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  252|      4|	int rc = lua_istable(L, index);
  253|      4|	assert(rc == 0 || rc == 1);
  254|      4|}
torture_test.cc:_ZL14__lua_isthreadP9lua_StateP18FuzzedDataProvider:
  515|      6|{
  516|      6|	int top = lua_gettop(L);
  517|      6|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  518|      6|	int rc = lua_isthread(L, index);
  519|      6|	assert(rc == 0 || rc == 1);
  520|      6|}
torture_test.cc:_ZL16__lua_isuserdataP9lua_StateP18FuzzedDataProvider:
  504|      4|{
  505|      4|	int top = lua_gettop(L);
  506|      4|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  507|      4|	int rc = lua_isuserdata(L, index);
  508|      4|	assert(rc == 0 || rc == 1);
  509|      4|}
torture_test.cc:_ZL15__luaL_callmetaP9lua_StateP18FuzzedDataProvider:
 1687|      8|{
 1688|      8|	int top = lua_gettop(L);
 1689|      8|	auto obj = fdp->ConsumeIntegralInRange(1, top);
 1690|      8|	luaL_callmeta(L, obj, MT_FUNC_NAME_TORTURE);
  ------------------
  |  |   44|      8|#define MT_FUNC_NAME_TORTURE "__torture"
  ------------------
 1691|      8|	assert(lua_gettop(L) == top || lua_gettop(L) == top + 1);
 1692|      8|}
torture_test.cc:_ZL15__luaL_checkanyP9lua_StateP18FuzzedDataProvider:
 1375|      5|{
 1376|      5|	int top = lua_gettop(L);
 1377|      5|	uint8_t arg = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1378|       |	/*
 1379|       |	 * Functions called luaL_check* always raise an error
 1380|       |	 * if the check is not satisfied.
 1381|       |	 */
 1382|      5|	luaL_checkany(L, arg);
 1383|      5|	assert(lua_gettop(L) == top);
 1384|      5|}
torture_test.cc:_ZL19__luaL_checkintegerP9lua_StateP18FuzzedDataProvider:
 1325|      9|{
 1326|      9|	int top = lua_gettop(L);
 1327|      9|	uint8_t arg = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1328|       |	/*
 1329|       |	 * Functions called luaL_check* always raise an error
 1330|       |	 * if the check is not satisfied.
 1331|       |	 */
 1332|      9|	if (lua_type(L, arg) != LUA_TNUMBER)
  ------------------
  |  Branch (1332:6): [True: 7, False: 2]
  ------------------
 1333|      7|		return;
 1334|      2|	luaL_checkinteger(L, arg);
 1335|      2|	assert(lua_gettop(L) == top);
 1336|      2|}
torture_test.cc:_ZL18__luaL_checknumberP9lua_StateP18FuzzedDataProvider:
 1308|      9|{
 1309|      9|	int top = lua_gettop(L);
 1310|      9|	uint8_t narg = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1311|       |	/*
 1312|       |	 * Functions called luaL_check* always raise an error
 1313|       |	 * if the check is not satisfied.
 1314|       |	 */
 1315|      9|	if (lua_type(L, narg) != LUA_TNUMBER)
  ------------------
  |  Branch (1315:6): [True: 7, False: 2]
  ------------------
 1316|      7|		return;
 1317|      2|	luaL_checknumber(L, narg);
 1318|      2|	assert(lua_gettop(L) == top);
 1319|      2|}
torture_test.cc:_ZL17__luaL_checkstackP9lua_StateP18FuzzedDataProvider:
 1605|      2|{
 1606|      2|	int top = lua_gettop(L);
 1607|      2|	int sz = top + 1;
 1608|      2|	char err_msg[] = "shit happens";
 1609|      2|	luaL_checkstack(L, sz, err_msg);
 1610|      2|	assert(lua_gettop(L) == top);
 1611|      2|}
torture_test.cc:_ZL18__luaL_checkstringP9lua_StateP18FuzzedDataProvider:
 1342|     21|{
 1343|     21|	int top = lua_gettop(L);
 1344|     21|	uint8_t arg = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1345|       |	/*
 1346|       |	 * Functions called luaL_check* always raise an error
 1347|       |	 * if the check is not satisfied.
 1348|       |	 */
 1349|     21|	if (lua_type(L, arg) != LUA_TSTRING)
  ------------------
  |  Branch (1349:6): [True: 17, False: 4]
  ------------------
 1350|     17|		return;
 1351|      4|	luaL_checkstring(L, arg);
 1352|      4|	assert(lua_gettop(L) == top);
 1353|      4|}
torture_test.cc:_ZL16__luaL_checktypeP9lua_StateP18FuzzedDataProvider:
 1359|     12|{
 1360|     12|	int top = lua_gettop(L);
 1361|     12|	uint8_t arg = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1362|       |	/*
 1363|       |	 * Functions called luaL_check* always raise an error
 1364|       |	 * if the check is not satisfied.
 1365|       |	 */
 1366|     12|	int type = lua_type(L, arg);
 1367|     12|	luaL_checktype(L, arg, type);
 1368|     12|	assert(lua_gettop(L) == top);
 1369|     12|}
torture_test.cc:_ZL19__luaL_getmetafieldP9lua_StateP18FuzzedDataProvider:
 1635|      8|{
 1636|      8|	int top = lua_gettop(L);
 1637|      8|	auto obj = fdp->ConsumeIntegralInRange(1, top);
 1638|      8|	const char e[] = "xxx";
 1639|      8|	luaL_getmetafield(L, obj, e);
 1640|      8|	assert(lua_gettop(L) == top || lua_gettop(L) == top + 1);
 1641|      8|}
torture_test.cc:_ZL17__luaL_loadstringP9lua_StateP18FuzzedDataProvider:
 1676|     44|{
 1677|     44|	int top = lua_gettop(L);
 1678|     44|	int res = luaL_loadstring(L, "a = a + 1");
 1679|     44|	assert(res == LUA_OK);
 1680|      0|	assert(lua_gettop(L) == top + 1);
 1681|     44|}
torture_test.cc:_ZL10__luaL_refP9lua_StateP18FuzzedDataProvider:
 1592|     35|{
 1593|     35|	int top = lua_gettop(L);
 1594|     35|	auto idx = fdp->ConsumeIntegralInRange(1, top);
 1595|     35|	if (lua_type(L, idx) != LUA_TTABLE)
  ------------------
  |  Branch (1595:6): [True: 6, False: 29]
  ------------------
 1596|      6|		return;
 1597|     29|	luaL_ref(L, idx);
 1598|     29|	assert(lua_gettop(L) == top - 1);
 1599|     29|}
torture_test.cc:_ZL16__luaL_tolstringP9lua_StateP18FuzzedDataProvider:
 1465|     17|{
 1466|     17|	int top = lua_gettop(L);
 1467|     17|	auto idx = fdp->ConsumeIntegralInRange(1, top);
 1468|     17|#if LUA_VERSION_NUM < 503
 1469|     17|	lua_tolstring(L, idx, NULL);
 1470|       |#else
 1471|       |	luaL_tolstring(L, idx, NULL);
 1472|       |#endif /* LUA_VERSION_NUM */
 1473|       |	/* XXX: Wrong number of elements. */
 1474|       |	/* assert(lua_gettop(L) == top + 1); */
 1475|     17|}
torture_test.cc:_ZL16__luaL_tracebackP9lua_StateP18FuzzedDataProvider:
 1454|      9|{
 1455|      9|	int top = lua_gettop(L);
 1456|      9|	auto buf = fdp->ConsumeRandomLengthString(max_str_len);
 1457|      9|	luaL_traceback(L, L, buf.c_str(), 1);
 1458|      9|	assert(lua_gettop(L) == top + 1);
 1459|      9|}
torture_test.cc:_ZL12__luaL_whereP9lua_StateP18FuzzedDataProvider:
 1698|      4|{
 1699|      4|	int top = lua_gettop(L);
 1700|      4|	luaL_where(L, 1);
 1701|      4|	assert(lua_gettop(L) == top + 1);
 1702|      4|}
torture_test.cc:_ZL17__lua_newuserdataP9lua_StateP18FuzzedDataProvider:
 1270|      6|{
 1271|      6|	uint8_t size = fdp->ConsumeIntegral<uint8_t>();
 1272|      6|	lua_newuserdata(L, size);
 1273|      6|}
torture_test.cc:_ZL10__lua_nextP9lua_StateP18FuzzedDataProvider:
  537|     16|{
  538|     16|	int top = lua_gettop(L);
  539|     16|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  540|     16|	if (!lua_istable(L, index))
  ------------------
  |  Branch (540:6): [True: 3, False: 13]
  ------------------
  541|      3|		return;
  542|     13|	lua_pushnil(L);  /* first key */
  543|     13|	lua_next(L, index);
  544|     13|	assert(lua_gettop(L) - top - 1 <= 2);
  545|     13|}
torture_test.cc:_ZL11__lua_pcallP9lua_StateP18FuzzedDataProvider:
 1661|      4|{
 1662|      4|	int top = lua_gettop(L);
 1663|       |	/* Function to be called. */
 1664|      4|	lua_pushcfunction(L, cfunction);
 1665|      4|	int nargs = 0;
 1666|      4|	int nresults = 0;
 1667|      4|	int res = lua_pcall(L, nargs, nresults, 0);
 1668|      4|	assert(res == LUA_OK);
 1669|      0|	assert(lua_gettop(L) == top + nresults - nargs);
 1670|      4|}
torture_test.cc:_ZL9__lua_popP9lua_StateP18FuzzedDataProvider:
   78|      8|{
   79|      8|	int top = lua_gettop(L);
   80|      8|	uint8_t n = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
   81|      8|	lua_pop(L, n);
   82|      8|	assert(lua_gettop(L) == top - n);
   83|      8|}
torture_test.cc:_ZL18__lua_pushcclosureP9lua_StateP18FuzzedDataProvider:
  577|     26|{
  578|       |	/* Maximum n is 255 in lua_pushcclosure(3). */
  579|     26|	int n = fdp->ConsumeIntegralInRange<uint8_t>(1, 10);
  580|    144|	for (int i = 1; i < n; i++)
  ------------------
  |  Branch (580:18): [True: 118, False: 26]
  ------------------
  581|    118|		lua_pushnumber(L, i);
  582|     26|	lua_pushcclosure(L, cfunction, n);
  583|     26|}
torture_test.cc:_ZL17__lua_pushfstringP9lua_StateP18FuzzedDataProvider:
 1279|    346|{
 1280|    346|	int top = lua_gettop(L);
 1281|    346|	auto arg1 = fdp->ConsumeRandomLengthString(max_str_len);
 1282|    346|	auto arg2 = fdp->ConsumeRandomLengthString(max_str_len);
 1283|    346|	auto arg3 = fdp->ConsumeRandomLengthString(max_str_len);
 1284|    346|	auto arg4 = fdp->ConsumeRandomLengthString(max_str_len);
 1285|    346|	auto arg5 = fdp->ConsumeRandomLengthString(max_str_len);
 1286|    346|	char fmt_str[] = "%s %f %p %d %c";
 1287|    346|	lua_pushfstring(L, fmt_str, arg1.c_str(), arg2.c_str(),
 1288|    346|	                            arg3.c_str(), arg4.c_str(),
 1289|    346|	                            arg5.c_str());
 1290|    346|	assert(lua_gettop(L) == top + 1);
 1291|    346|}
torture_test.cc:_ZL16__lua_pushthreadP9lua_StateP18FuzzedDataProvider:
  526|      4|{
  527|      4|	int top = lua_gettop(L);
  528|      4|	int rc = lua_pushthread(L);
  529|      4|	assert(rc == 1);
  530|      0|	assert(lua_gettop(L) == top + 1);
  531|      4|}
torture_test.cc:_ZL15__lua_pushvalueP9lua_StateP18FuzzedDataProvider:
  303|      3|{
  304|      3|	int top = lua_gettop(L);
  305|      3|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  306|      3|	lua_pushvalue(L, index);
  307|      3|	assert(lua_gettop(L) == top + 1);
  308|      3|}
torture_test.cc:_ZL14__lua_rawequalP9lua_StateP18FuzzedDataProvider:
 1440|     19|{
 1441|     19|	int top = lua_gettop(L);
 1442|     19|	if (top < 2)
  ------------------
  |  Branch (1442:6): [True: 0, False: 19]
  ------------------
 1443|      0|		return;
 1444|     19|	uint8_t index1 = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1445|     19|	uint8_t index2 = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1446|     19|	lua_rawequal(L, index1, index2);
 1447|     19|	assert(lua_gettop(L) == top);
 1448|     19|}
torture_test.cc:_ZL12__lua_rawgetP9lua_StateP18FuzzedDataProvider:
  745|      7|{
  746|      7|	int top = lua_gettop(L);
  747|      7|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  748|      7|	if (!lua_istable(L, index))
  ------------------
  |  Branch (748:6): [True: 3, False: 4]
  ------------------
  749|      3|		return;
  750|      4|	uint8_t key = fdp->ConsumeIntegral<uint8_t>();
  751|      4|	lua_pushnumber(L, key);
  752|      4|	lua_rawget(L, index);
  753|       |	/* XXX: Wrong number of elements. */
  754|       |	/* assert(lua_gettop(L) == top); */
  755|      4|}
torture_test.cc:_ZL13__lua_rawgetiP9lua_StateP18FuzzedDataProvider:
  797|      9|{
  798|      9|	int top = lua_gettop(L);
  799|      9|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  800|      9|	if (!lua_istable(L, index))
  ------------------
  |  Branch (800:6): [True: 4, False: 5]
  ------------------
  801|      4|		return;
  802|      5|	int i = fdp->ConsumeIntegral<uint8_t>();
  803|      5|	lua_rawgeti(L, index, i);
  804|      5|	assert(lua_gettop(L) == top + 1);
  805|      5|}
torture_test.cc:_ZL12__lua_rawsetP9lua_StateP18FuzzedDataProvider:
  761|     17|{
  762|     17|	int top = lua_gettop(L);
  763|     17|	if (top == 0)
  ------------------
  |  Branch (763:6): [True: 0, False: 17]
  ------------------
  764|      0|		return;
  765|     17|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  766|     17|	if (!lua_istable(L, index))
  ------------------
  |  Branch (766:6): [True: 4, False: 13]
  ------------------
  767|      4|		return;
  768|     13|	uint8_t key = fdp->ConsumeIntegral<uint8_t>();
  769|     13|	uint8_t value = fdp->ConsumeIntegral<uint8_t>();
  770|     13|	lua_pushnumber(L, value);
  771|     13|	lua_pushnumber(L, key);
  772|     13|	lua_rawset(L, index);
  773|       |	/* XXX: Wrong number of elements. */
  774|       |	/* assert(lua_gettop(L) == top - 2); */
  775|     13|}
torture_test.cc:_ZL13__lua_rawsetiP9lua_StateP18FuzzedDataProvider:
  781|     21|{
  782|     21|	int top = lua_gettop(L);
  783|     21|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  784|     21|	if (!lua_istable(L, index))
  ------------------
  |  Branch (784:6): [True: 2, False: 19]
  ------------------
  785|      2|		return;
  786|     19|	int n = fdp->ConsumeIntegral<uint8_t>();
  787|     19|	__lua_pushnumber(L, fdp);
  788|     19|	lua_rawseti(L, index, n);
  789|       |	/* XXX: Wrong number of elements. */
  790|       |	/* assert(lua_gettop(L) == top - 1); */
  791|     19|}
torture_test.cc:_ZL14__lua_registerP9lua_StateP18FuzzedDataProvider:
 1153|      5|{
 1154|      5|	int top = lua_gettop(L);
 1155|      5|	lua_register(L, "cfunction", cfunction);
 1156|      5|	assert(lua_gettop(L) == top);
 1157|      5|}
torture_test.cc:_ZL12__lua_removeP9lua_StateP18FuzzedDataProvider:
  314|      7|{
  315|      7|	int top = lua_gettop(L);
  316|      7|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  317|      7|	lua_remove(L, index);
  318|      7|	assert(lua_gettop(L) == top - 1);
  319|      7|}
torture_test.cc:_ZL13__lua_replaceP9lua_StateP18FuzzedDataProvider:
  325|      7|{
  326|      7|	int top = lua_gettop(L);
  327|      7|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  328|      7|	lua_replace(L, index);
  329|      7|	assert(lua_gettop(L) == top - 1);
  330|      7|}
torture_test.cc:_ZL12__lua_resumeP9lua_StateP18FuzzedDataProvider:
 1168|     22|{
 1169|     22|	lua_State *co = lua_newthread(L);
 1170|     22|	lua_pushcfunction(co, cfunction);
 1171|     22|	int res = -1;
 1172|     22|#if LUA_VERSION_NUM == 501
 1173|     22|	res = lua_resume(L, 0);
 1174|       |#elif LUA_VERSION_NUM == 503 || LUA_VERSION_NUM == 502
 1175|       |	res = lua_resume(co, L, 0);
 1176|       |#else
 1177|       |	int nres;
 1178|       |	res = lua_resume(co, L, 0, &nres);
 1179|       |#endif /* LUA_VERSION_NUM */
 1180|       |	/* XXX: Wrong exit code. */
 1181|       |	/* assert(res == LUA_OK); */
 1182|     22|	(void)res;
 1183|     22|	lua_settop(co, 0);
 1184|     22|}
torture_test.cc:_ZL14__lua_setfieldP9lua_StateP18FuzzedDataProvider:
 1190|     25|{
 1191|     25|	int top = lua_gettop(L);
 1192|     25|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1193|     25|	if (lua_type(L, index) != LUA_TTABLE)
  ------------------
  |  Branch (1193:6): [True: 3, False: 22]
  ------------------
 1194|      3|		return;
 1195|     22|	auto k = fdp->ConsumeRemainingBytesAsString();
 1196|     22|	lua_setfield(L, index, k.c_str());
 1197|     22|	assert(lua_gettop(L) == top - 1);
 1198|     22|}
torture_test.cc:_ZL15__lua_setglobalP9lua_StateP18FuzzedDataProvider:
  336|      6|{
  337|      6|	int top = lua_gettop(L);
  338|      6|	auto str = fdp->ConsumeRandomLengthString(max_str_len);
  339|      6|	lua_setglobal(L, str.c_str());
  340|      6|	assert(lua_gettop(L) == top - 1);
  341|      6|}
torture_test.cc:_ZL18__lua_setmetatableP9lua_StateP18FuzzedDataProvider:
 1002|     12|{
 1003|     12|	luaL_getmetatable(L, TYPE_NAME_TORTURE);
 1004|     12|	int top = lua_gettop(L);
 1005|     12|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1006|     12|	lua_setmetatable(L, index);
 1007|     12|	assert(lua_gettop(L) == top - 1);
 1008|     12|}
torture_test.cc:_ZL14__lua_settableP9lua_StateP18FuzzedDataProvider:
 1241|     11|{
 1242|     11|	int top = lua_gettop(L);
 1243|     11|	lua_createtable(L, 0, 1);
 1244|       |
 1245|     11|	lua_pushstring(L, "language");
 1246|     11|	lua_pushstring(L, "Lua");
 1247|     11|	lua_settable(L, -3);
 1248|       |
 1249|     11|	assert(lua_gettop(L) == top + 1);
 1250|     11|}
torture_test.cc:_ZL12__lua_settopP9lua_StateP18FuzzedDataProvider:
  347|      6|{
  348|      6|	int top = lua_gettop(L);
  349|      6|	int grow_slots = 2;
  350|      6|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top + grow_slots);
  351|      6|	lua_settop(L, index);
  352|      6|	assert(lua_gettop(L) == index);
  353|      6|}
torture_test.cc:_ZL16__lua_setupvalueP9lua_StateP18FuzzedDataProvider:
  458|      5|{
  459|      5|	int top = lua_gettop(L);
  460|      5|	int funcindex = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  461|      5|	int n = fdp->ConsumeIntegral<uint8_t>();
  462|      5|	lua_setupvalue(L, funcindex, n);
  463|      5|	assert(lua_gettop(L) == top);
  464|      5|}
torture_test.cc:_ZL12__lua_statusP9lua_StateP18FuzzedDataProvider:
  359|      8|{
  360|      8|	int rc = lua_status(L);
  361|      8|	assert(rc == 0 || rc == LUA_YIELD);
  362|      8|}
torture_test.cc:_ZL15__lua_tobooleanP9lua_StateP18FuzzedDataProvider:
  368|      8|{
  369|      8|	int top = lua_gettop(L);
  370|      8|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  371|      8|	int rc = lua_toboolean(L, index);
  372|      8|	assert(rc == 0 || rc == 1);
  373|      8|}
torture_test.cc:_ZL17__lua_tocfunctionP9lua_StateP18FuzzedDataProvider:
 1230|      6|{
 1231|      6|	int top = lua_gettop(L);
 1232|      6|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1233|      6|	lua_tocfunction(L, index);
 1234|      6|	assert(lua_gettop(L) == top);
 1235|      6|}
torture_test.cc:_ZL15__lua_tointegerP9lua_StateP18FuzzedDataProvider:
  379|     10|{
  380|     10|	int top = lua_gettop(L);
  381|     10|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  382|     10|	lua_tointeger(L, index);
  383|     10|	assert(lua_gettop(L) == top);
  384|     10|}
torture_test.cc:_ZL16__lua_tointegerxP9lua_StateP18FuzzedDataProvider:
  390|      8|{
  391|      8|	int top = lua_gettop(L);
  392|      8|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  393|      8|	int isnum;
  394|      8|	lua_tointegerx(L, index, &isnum);
  395|      8|	assert(isnum == 0 || isnum == 1);
  396|      0|	assert(lua_gettop(L) == top);
  397|      8|}
torture_test.cc:_ZL15__lua_tolstringP9lua_StateP18FuzzedDataProvider:
  403|      3|{
  404|      3|	int top = lua_gettop(L);
  405|      3|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  406|      3|	lua_tolstring(L, index, NULL);
  407|      3|	assert(lua_gettop(L) == top);
  408|      3|}
torture_test.cc:_ZL14__lua_tonumberP9lua_StateP18FuzzedDataProvider:
  100|      5|{
  101|      5|	int top = lua_gettop(L);
  102|      5|	uint8_t n = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  103|      5|	lua_tonumber(L, n);
  104|      5|	assert(lua_gettop(L) == top);
  105|      5|}
torture_test.cc:_ZL15__lua_topointerP9lua_StateP18FuzzedDataProvider:
 1204|      6|{
 1205|      6|	int top = lua_gettop(L);
 1206|      6|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1207|      6|	const void *p = lua_topointer(L, index);
 1208|       |	/*
 1209|       |	 * The value can be a userdata, a table, a thread, or a function;
 1210|       |	 * otherwise, lua_topointer returns NULL.
 1211|       |	 */
 1212|      6|	int type = lua_type(L, index);
 1213|      6|	if (type == LUA_TUSERDATA  ||
  ------------------
  |  Branch (1213:6): [True: 0, False: 6]
  ------------------
 1214|      6|	    type == LUA_TTHREAD    ||
  ------------------
  |  Branch (1214:6): [True: 1, False: 5]
  ------------------
 1215|      6|	    type == LUA_TTABLE     ||
  ------------------
  |  Branch (1215:6): [True: 2, False: 3]
  ------------------
 1216|      6|#if LUA_VERSION_NUM > 503 || defined(LUAJIT)
 1217|      6|	    type == LUA_TSTRING    ||
  ------------------
  |  Branch (1217:6): [True: 1, False: 2]
  ------------------
 1218|      6|#endif /* LUA_VERSION_NUM */
 1219|      6|	    type == LUA_TFUNCTION)
  ------------------
  |  Branch (1219:6): [True: 1, False: 1]
  ------------------
 1220|      5|		assert(p);
 1221|      1|	else
 1222|      1|		assert(p == NULL);
 1223|      0|	assert(lua_gettop(L) == top);
 1224|      6|}
torture_test.cc:_ZL14__lua_tostringP9lua_StateP18FuzzedDataProvider:
  414|      3|{
  415|      3|	int top = lua_gettop(L);
  416|      3|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  417|      3|	lua_tostring(L, index);
  418|      3|	assert(lua_gettop(L) == top);
  419|      3|}
torture_test.cc:_ZL14__lua_tothreadP9lua_StateP18FuzzedDataProvider:
 1297|      5|{
 1298|      5|	int top = lua_gettop(L);
 1299|      5|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1300|      5|	lua_tothread(L, index);
 1301|      5|	assert(lua_gettop(L) == top);
 1302|      5|}
torture_test.cc:_ZL16__lua_touserdataP9lua_StateP18FuzzedDataProvider:
  482|      6|{
  483|      6|	int top = lua_gettop(L);
  484|      6|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  485|      6|	lua_touserdata(L, index);
  486|      6|	assert(lua_gettop(L) == top);
  487|      6|}
torture_test.cc:_ZL10__lua_typeP9lua_StateP18FuzzedDataProvider:
  425|     14|{
  426|     14|	int top = lua_gettop(L);
  427|     14|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  428|     14|	int type = lua_type(L, index);
  429|     14|	assert(type == LUA_TBOOLEAN       ||
  430|     14|	       type == LUA_TFUNCTION      ||
  431|     14|	       type == LUA_TLIGHTUSERDATA ||
  432|     14|	       type == LUA_TNIL           ||
  433|     14|	       type == LUA_TNONE          ||
  434|     14|	       type == LUA_TNUMBER        ||
  435|     14|	       type == LUA_TSTRING        ||
  436|     14|	       type == LUA_TTABLE         ||
  437|     14|	       type == LUA_TTHREAD        ||
  438|     14|	       type == LUA_TUSERDATA      ||
  439|     14|	       type == LUA_TNONE);
  440|      0|	assert(lua_gettop(L) == top);
  441|     14|}
torture_test.cc:_ZL14__lua_typenameP9lua_StateP18FuzzedDataProvider:
  631|      2|{
  632|      2|	int top = lua_gettop(L);
  633|      2|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  634|      2|	const char* name = lua_typename(L, index);
  635|      2|	assert(name);
  636|      0|	assert(lua_gettop(L) == top);
  637|      2|}
torture_test.cc:_ZL15__lua_upvalueidP9lua_StateP18FuzzedDataProvider:
 1421|      4|{
 1422|      4|	int funcindex = -1;
 1423|      4|	lua_Debug ar;
 1424|      4|	lua_pushcfunction(L, cfunction);
 1425|      4|	int n = fdp->ConsumeIntegral<uint8_t>();
 1426|      4|	lua_setupvalue(L, funcindex, n);
 1427|      4|	assert(lua_getinfo(L, ">u", &ar) == 1);
 1428|      4|	if (ar.nups == 0)
  ------------------
  |  Branch (1428:6): [True: 4, False: 0]
  ------------------
 1429|      4|		return;
 1430|      0|	int top = lua_gettop(L);
 1431|      0|	void *p = lua_upvalueid(L, funcindex, n);
 1432|      0|	assert(p);
 1433|      0|	assert(lua_gettop(L) == top);
 1434|      0|}
torture_test.cc:_ZL11__lua_xmoveP9lua_StateP18FuzzedDataProvider:
 1140|      4|{
 1141|      4|	lua_State *co1 = lua_newthread(L);
 1142|      4|	lua_State *co2 = lua_newthread(L);
 1143|      4|	__lua_pushnumber(co1, fdp);
 1144|      4|	lua_xmove(co1, co2, 1);
 1145|      4|	lua_settop(co1, 0);
 1146|      4|	lua_settop(co2, 0);
 1147|      4|}
torture_test.cc:_ZL12__lua_cpcallP9lua_StateP18FuzzedDataProvider:
 1037|      2|{
 1038|      2|	int top = lua_gettop(L);
 1039|      2|	int rc = lua_cpcall(L, cfunction, NULL);
 1040|      2|	assert(rc == 0);
 1041|      0|	assert(lua_gettop(L) - top <= 1);
 1042|      2|}
torture_test.cc:_ZL11__lua_equalP9lua_StateP18FuzzedDataProvider:
  812|     14|{
  813|     14|	int top = lua_gettop(L);
  814|     14|	if (top < 2)
  ------------------
  |  Branch (814:6): [True: 0, False: 14]
  ------------------
  815|      0|		return;
  816|     14|	uint8_t index1 = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  817|     14|	uint8_t index2 = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  818|     14|	lua_equal(L, index1, index2);
  819|     14|	assert(lua_gettop(L) == top);
  820|     14|}
torture_test.cc:_ZL13__lua_getfenvP9lua_StateP18FuzzedDataProvider:
  909|     12|{
  910|     12|	int top = lua_gettop(L);
  911|     12|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  912|     12|	lua_getfenv(L, index);
  913|     12|	assert(lua_gettop(L) == top + 1);
  914|     12|}
torture_test.cc:_ZL14__lua_lessthanP9lua_StateP18FuzzedDataProvider:
  828|     19|{
  829|     19|	int top = lua_gettop(L);
  830|     19|	uint8_t index1 = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  831|     19|	int type1 = lua_type(L, index1);
  832|     19|	switch (type1) {
  833|      2|	case LUA_TNUMBER:
  ------------------
  |  Branch (833:2): [True: 2, False: 17]
  ------------------
  834|      2|		__lua_pushnumber(L, fdp);
  835|      2|		break;
  836|      7|	case LUA_TSTRING:
  ------------------
  |  Branch (836:2): [True: 7, False: 12]
  ------------------
  837|      7|		__lua_pushstring(L, fdp);
  838|      7|		break;
  839|     10|	default:
  ------------------
  |  Branch (839:2): [True: 10, False: 9]
  ------------------
  840|     10|		return;
  841|     19|	}
  842|      9|	int rc = lua_lessthan(L, index1, -1);
  843|      9|	assert(rc == 0 || rc == 1);
  844|      9|}
torture_test.cc:_ZL12__lua_objlenP9lua_StateP18FuzzedDataProvider:
  852|      6|{
  853|      6|	int top = lua_gettop(L);
  854|      6|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  855|      6|#if LUA_VERSION_NUM == 501
  856|      6|	lua_objlen(L, index);
  857|       |#else
  858|       |	lua_rawlen(L, index);
  859|       |#endif /* LUA_VERSION_NUM */
  860|      6|	assert(lua_gettop(L) == top);
  861|      6|}
torture_test.cc:_ZL13__lua_setfenvP9lua_StateP18FuzzedDataProvider:
  922|     11|{
  923|     11|	int top = lua_gettop(L);
  924|     11|	uint8_t index = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
  925|     11|	if (!lua_istable(L, -1))
  ------------------
  |  Branch (925:6): [True: 6, False: 5]
  ------------------
  926|      6|		return;
  927|      5|	lua_setfenv(L, index);
  928|      5|	assert(lua_gettop(L) == top - 1);
  929|      5|}
torture_test.cc:_ZL10__lua_copyP9lua_StateP18FuzzedDataProvider:
 1482|      9|{
 1483|      9|	int top = lua_gettop(L);
 1484|      9|	uint8_t fromidx = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1485|      9|	uint8_t toidx = fdp->ConsumeIntegralInRange<uint8_t>(1, top);
 1486|      9|	if (fromidx == toidx)
  ------------------
  |  Branch (1486:6): [True: 6, False: 3]
  ------------------
 1487|      6|		return;
 1488|      3|	lua_copy(L, fromidx, toidx);
 1489|      3|	assert(lua_gettop(L) == top);
 1490|      3|}
torture_test.cc:_ZL17__lua_isyieldableP9lua_StateP18FuzzedDataProvider:
 1025|      3|{
 1026|      3|	(void)fdp;
 1027|      3|	int rc = lua_isyieldable(L);
 1028|      3|	assert(rc == 0 || rc == 1);
 1029|      3|}
torture_test.cc:_ZL19__luaL_setmetatableP9lua_StateP18FuzzedDataProvider:
 1014|     11|{
 1015|     11|	int top = lua_gettop(L);
 1016|     11|	luaL_setmetatable(L, TYPE_NAME_TORTURE);
  ------------------
  |  |   43|     11|#define TYPE_NAME_TORTURE "torture_test"
  ------------------
 1017|     11|	assert(lua_gettop(L) == top);
 1018|     11|}
torture_test.cc:_ZL15__lua_tonumberxP9lua_StateP18FuzzedDataProvider:
  111|      9|{
  112|      9|	int top = lua_gettop(L);
  113|      9|	auto index = fdp->ConsumeIntegralInRange(1, top);
  114|      9|	int isnum;
  115|      9|	lua_tonumberx(L, index, &isnum);
  116|      9|	assert(isnum == 0 || isnum == 1);
  117|      0|	assert(lua_gettop(L) == top);
  118|      9|}
torture_test.cc:_ZL13__lua_versionP9lua_StateP18FuzzedDataProvider:
 1618|      4|{
 1619|      4|	int top = lua_gettop(L);
 1620|      4|#if LUA_VERSION_NUM < 504
 1621|      4|	const lua_Number *v = lua_version(L);
 1622|      4|	assert(v);
 1623|       |#else
 1624|       |	lua_Number v = lua_version(L);
 1625|       |	assert(v != 0);
 1626|       |#endif /* LUA_VERSION_NUM */
 1627|      0|	assert(lua_gettop(L) == top);
 1628|      4|}

