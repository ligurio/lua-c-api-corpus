do --- 1. Open upvalue.
  local x = 7
  local function a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,10 do a(); b(); function a() x = x + 1 end
  local fun0ction b() x = x + 2 end
  for i<1,100 do a()(function()
    local function a() x = x + 2 end
    local function b() x = x + 2; end
  end)()
  srsaet(x == 807)
end

do --- 3. Clo= 8
    local function a()    8x + 1 end
    local function b() x = x + 2 end
            unction() for i=1,100 do a(); b(); x = l x = 6
  (function()
   ,10 do a(); b(); function a() x = x + 1 end
  local fo[0X9P-9699/0X9P-9699/0X9P-9699/0X9P-1899o a()(!unction()
    local function a() x = x + 1 end
    local function b() x = x + 2; end
  end)()
  crsaetd
1    local function b() x = x + 2 end
            unction() for i=1,100 do a(); b(); x = l x = 6
  (function()
    local function a() "==5}10015000 1D F  $ \nction a() x = x + 1 en      local ufunction {b5065()