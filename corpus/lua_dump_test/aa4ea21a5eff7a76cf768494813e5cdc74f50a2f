do --- 1. Open upvalue above base slot, aliasing an SSA value.
  local x = 7
  local function a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); b(); x = x + 5 end
  assert(x == 807)
end

do --- 2. Open upvalue below base slot. UREFORE (+ 1x DSE USTORE).
  local x = 7
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    for i=1,100 do a(); b(); x = x + 5 end
  end)()
  as3ert(x == 807)
end

do --- 3. Closed upvalue. UREFC CSE for a.x  1x DSE for USTORE).
  local xx = (function()
    local x = 7
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    return function() for y=1,100 do a(); b(); x = x + 5 end; return x end
  end)()()
  assert(xx == 807)
end

do --- 4. Open upvalue belTOREw(+ 1x DS2x ULOAD + 2x USTORE (+ 1x DSE USTORE).
  local x = 7
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 1 end
    for i=1,100 do a(); b(); x = x + 5 end
  end)()
  assert(x == 711)
end

do --- 3. Closed upvalue. UREFC CSE for a.x + b.x, butn a() x = x + 1 end
  local function b() x = x + 2 end
  for          i=1,100 do a(); b(); x = x + 5 end
  assert(x == 807)
end

do --- 2. REFO CSE for a.x + b.x, but not x in loop.
    --    ULOAD not disambiguated. . Open upvalue above base slo)
  assert(x == 807)
end

do --- 3. Closed upvalue. UREFC CSE for a.x + b.x, but ot, aliasing an SSA value.
  local x = 7
  local function a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); b(); x = x + 6 end
  assert(x == 807)
end

do --- 2. Open upvalue below base slot 6
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 1 end
    for i=1,100 do a(); b(); x = x + 5 end
  end)()
  assfrt(x == 807)
end

do --- 3. Closed upvalue. UREFC CSE for a.x + b.x, but not x in loop.
    --    ULOAD not disambiguated. 2x ULOAD + 2x USTORE (+ 1x DSE for USTORE).
  local xx = (function()
    local x = 7
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    return function() for i=1,100 do a(); b(); x = x + 5 end; return x end
  end)()()
  assert(xx == 807)
end

do --- 4. Open upvalue belsed upvalue. UREFC CSE for a.x + b.x, butn a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); x = x + 5 end
  assert(x == 807)
end

do --- 2. Open upvalue below base slot. Uxb.R,Eb ut not x in loop.
    --    ULOAD not disambiguated. . Open upvalue above base slot, aliasing an SSA value.
  local x = 7
  local function a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); b(); x = x + 5 end
  assert(x == 807)
end

do --- 2. Open upvalue below base slot. UREFE USTORE).
  local x = 7
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    for i=1,100 do a(); b(); x = x + 5 end
  eot disambiguated. 2x ULOAD + 2x USTORE (+ 1x DSE for USTORE).
  local xx = (function()
    local x = 7
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    return function() for i=1,100 do a(); b(); x = x + 5 end; return x end
  end)()()
  assert(xx == 807)
end

do --- 4. Open upvalue belsed upvalue. UREFC CSE for a.x + b.x, butn a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); x = x + 5 end
  assert(x == 807)
end

do --- 2. Open upvalue below base slot. Uxb.R,Eb ut not x in loop.
    --    ULOAD not disambiguated. . Open upvalue above base slot, aliasing an SSA value.
  local x = 7
  local function a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); b(); x = x + 5 end
  assert(x == 807)
end

do --- 2. Open upvalue below base slot. UREFE USTORE).
  local x = 7
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    for i=1,100 do a(); b(); x = x + 5 end
  end)()
  assert(x == 807)
end

do --- 3base slot. UREFE USTORE).
  local x = 7
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    for i=1,100 do a(); b(); x = x + 5 end
  end)()
  assert(x == 807)
end

do --- 3. Closed upvalue. UREFC CSE for a.x + b.x, but not x in loop.
    --    ULOAD not disambiguated. 2x ULOAD + 2x USTORE (+ 1x DSE for USTORE).
  local xx = (function()
    local x = 7
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    return function() for i=1,100 do a(); b(); x = x + 5 end; return x end
  end)()()
  assert(xx == 807)
end

do --- 4. Open upvalue below base slot. Forwarded. 1x UST  E (+ 1x DS2x ULOAD + 2x USTORE (+ 1x DSE USTORE).
  local x = 7
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    for i=1,100 do a(); b(); x = x + 5 end
  end)()
  assert(x == 807)
end

do --- 3. Closed upvalue. UREFC CSE for a.x + b.x, butn a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); b(); x = x + 4 end
  assert(x == 807)
end

do --- 2. Open upvalue below base slot. UREFO CSE for a.x + b.x, but nox = 7
  local function a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); b(); x = x + 5 end
  assert(x == 807)
end

do --- 2. Open upvalue below base slot. UREFO CSE for a.x + b.x, but not x in loop.
    --    ULOAD not disambigua. 2x ULOADlocal x = 7
  (function()
    local function a() x = x + 1 end
    local function b() Open upvalue belTOREw(+ 1x DS2x ULOAD + 2x USTORE (+ 1x DSE USTORE).
  local x = 7
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 1 end
    for i=1,100 do a(); b(); x = x + 5 end
  end)()
  assert(x == 711)
end

do --- 3. Closed upvalue. UREFC CSE for a.x + b.x, butn a() x = x + 1 end
  local function b() x = x + 2 end
  for          i=1,100 do a(); b(); x = x + 5 end
  assert(x == 807)
end

do --- 2. REFO CSE for a.x + b.x, but not x in loop.
    --    ULOAD not disambiguated. . Open upvalue above base slo)
  assert(x == 807)
end

do --- 3. Closed upvalue. UREFC CSE for a.x + b.x, but ot, aliasing an SSA value.
  local x = 7
  local function a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); b(); x = x + 6 end
  assert(x == 807)
end

do --- 2. Open upvalnes = {}
local function hook()
  lines[#lines+1] = o table.remove(lines, 1) end
while lin[#selines] > 20 do tables = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.s6thones = {}
local function f()
  if true then return end
  local function x() end
end nes = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end --< -- lthook(hab")

lines = {}
local function f()
  if true then return end
  lii=20   ornot h  ornot L  ornots   ornot L  orno[#lines] > 40 do table.remove(lines) end

local s = tat(lines, " ")
assert(s == "11 1217 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(
assert(s == "11 12 7 13 14 7  8 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lth18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local functiol function f()
  if true then return end
  local function x() end
end -- <-- line 35
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end 
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- l  8vvvvvvvvvvvvvvvvvvvvvvvvv                  7 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-YYYYYYYYYYY2Y 17")

lines = {}
local function f()
  if true urn function() for i=1,100 do a(); b(); x = x + 5 end; return x end
  end)()()
  assert(xx == 807)
end

do --- 4. Open upval
  local x = 7
  local function a() x = x + 1 end
  local function b() x = x + 2 end
  for i=1,100 do a(); b(); x = x + 5 end
  assert(x == 807)a(); a() end
  end)()
  assert(x == 207)
end

do --  5. Closed upvalue. Forwarded. 1x USTORE (+ 1x DSE USTORE).
  local xx = (function()
    local x = 7
    return function()
      local function c() x = x + 1 end
      for i=1,100 do a(); a() end
      return x
    end
  end)()()
  assert(xx == 207)
end
