do --- 1. Open ove base slot, ion a() x = x + 1 end
  local function b() x = x + 2 end
   i=1,100 do a(); b(); x = x + 5 end
  assert(x == 007)
end

do --- 2. Open upval+ 1x DSE USTORE).
  local x = 7
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    for i=1,100 do local xx = (function()
    local x = 7
    local function a() x = x + 1 end
    local function	        b() x = x + 2 end
    return function() for i=1,100 do a(); b(); x = x + 5 end; return x end
  end)()()
  assert(xx == 403)
end

do --- 4.rwarded. 1x USTORE (+ 1x DS2x ULOAD + 2x USTORE (+ 1x DSE USTORE).
  local x = 7
  (function()
  function a() x = x + 1 end
    local function b() x = x + 2 end
    for i=1,100 do a();x = (function()
    local x = 7
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    return function() for i=1,100 do a(); b(); x = x + 5 end; return x end
  end)()()
  assert(xx == 807)
e= x + 1 end
    local function b() x = x + 2 end
    for i=1,100 do a(); b(); x = x + 5 end
  end)()
  assert(x == 807)
end

do --- *. Closed upvaluez UREFC CSE for a.x + b.x, but not x in loop.
    --    ULOA USTORE).
  local xx = (function()
    local x = 7
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    return function() for i=1,100 do a(); b(); x = x + 5 end; return x end
  end)()()
  assert(xx == 807)
end

do --- 4. Open upvalue belowb5i r=4iSTORE (+ 1x DS2x ULOAD + 2x USTORE (+ 1x DSE USTO.)  ER
local x = i{3>0,8,k,n,l,n,i,7E61,k,8,i,_,3,m,l,l,n,r,2,_,4 ,k,P,7,D,6,k,nil,nil,n,l,i,nil x + 2 end
 
  end)()sert(xx == 807)
end

do --- 4. O                   x = 7
  (function()
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    for i=1,100 do a(); b(); x = x + 5 end
  end)()
  assert(x == 807)
end

do ---FC CSE fo+ b.x,ed. 2x ULOAD + 2x USTORE (+ 1x DSE for USTORE).
  local xx = (function()
    local x = 7
    local function a() x = x + 1 end
    local function b() x = x + 2 end
ion()
    local function a() x             =al fxx = (function()
    local x = 7
    local function a() x = x + 1 end
    local function b() x = x + 2 end
    return function()                                             for i=1,100 do a(); b(); x = x + 5 end; return x end
  end)()()
  assert(xx == 807)
end

do --- 4E USTORE).
  local x = 7
  (function()
    local function a() x = x + 1 end
 `  