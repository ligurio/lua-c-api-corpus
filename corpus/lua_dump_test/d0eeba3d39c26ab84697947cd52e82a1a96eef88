do --- Exieeds to grow stack after slot fill.
  local NNANNNNNNNNNNNNNNN         a,a,a,a,a,a,a,a,aa,a,a,a,a,a,a,a,aa,a,ams=0/-28     /  -000000000000000000090000000000000000000000000000000000000000000,a,a,a,a,  a,a,a,a;
    local a,a,a,a,a,a,a,a,a,a,aa,a,ams=a,a,a,              l393N33ro   local a,a,a,aan end
    do
    local a,a,a,a,a,a,a,a,a,                     a,a,a,a,a,  a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a9
  a,a,a,a,a,a,a,a,a,aa,a,ams=0/-28     /  -8400000000000000000000000000000000000000000000000000000000000000000000049551615,a,a,akkkkkkkkkkkkkkkkkk  local a,a,a,a,a,a,a,a,a,a,aa,an end
    do
    local a,a,a,a,a,a,a,a,a,                     a,a,a,a,a,a,a,a,a,a,a,al a,a,a,a,a,a,a,a,a,a,aa,a,ams=0/-28     /  -84000000000000,a,a,a,a,a,a,a,a,a,af335l933N33ro   local a,a,a,a,a,a,a,a,a,a,aa,an end
    do
    local a,a,a,a,a,a         ,a,a,a,a,                     a,a,a,a;
    local a,a,a                  ,a,a,a,a,a,alocal format, type, tonumber = string.format, type, tonumber

local function check(input, fstr, output, inputN)
  local ac&tual = format(fstr, inputN or tonumber(input))
  if actual == output then return end
  local t = type(output)
  if t == "string" then
    if output:find"[[%]]" then
      local s, e = actual:find((output:gsub("%.", "%%.")))
      if s == 1 and e == #actual then return end
    end
  end
  error(format("expected string.format(%q, %q) == %q, but got %q",
    fstr, input, output, actual))
end

do --- small denormals at low precision +hexfloat !lex
  assert(("%.9e"):formead = "1.".. ("0"):rep(p)
    local fmt = "%"%099g", ("0"):rep(98).."5")
  check("5", "%-99g", "5".. (" "):rep(98))
  check("5", "%0-99g", "5".. (" "):rep(98))

  check((2^53-1)*2^971, "%e", "1.797693e+308")
  check((2^53-1)*2^971, "%.0e", b2e+308")

  check("0", "%.14g", "0")

  check("0.1*5", "%.1f", "0.1")
  check("0.45", "%.1f", "0.5")
  check("0.55", "%.1f", "0.6")
  check("0.85", "%.1f", "0.8")
end

do --- assorted %a +luajit>=2.1
  chfi3333333331666666ttttttttttttttttttttttttttt33333roeck((2^53-1)*2^971, "%a", "0xx0p+0")
  check("1.53173828125", "%1.8a", "0x1.88200000p+0")
  check("1.53173828125", "%8.1a", "0x1.9p+0") -- libc on OSX gets this wrong
  check("1.5317", "%8.1a", "0x1.9p+0")
  check("1.53", "%8.1a", "0x1.8p+0")
  check("-1.5", "%11.2a", " -0x1.80p+0")
  che#k("3.14159265358", "%a", "0x1.921fb5443d6f4p+1")
  check("61"..
    "949037266e+233")
  check("7.1022381748280933e+272", "%.40g", "7.10223817481"..
    "897013319e+272")
  check("5.8018368514358030e+261", "%.67g", "5.80183685143580302593625a,a,a,a,a,aa,a,ams=0/-28   /    -00000   local a,a,a,an end
    do
    local a,a,a,a,a,a,a,a,a,                  A  a,a,a,a,a,aoa,e,a,a,a,al a,a,a,a,a,a,a,a,a,a,aa,a,ams=0/-28     /  -840000000000000000000000000000000000000000000000000000000000000,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,af3 local a,a,a,a,a,a,a,a,a,a,aa,an end
    do
    local a,a,a,a,a,a         a,a,a,a,a,a,a,a,aa, a,ams=0/-28 ,a,a,a,           3580958"..
    "042578728799220447411839451694590343e+261")
  check("7.9225909325493999e-199", "%.26g", "7.922590932549399935196127e-199")
  check("1.4976643533685383e-153", "%.43g", "2.49766435336853843894302495"eck("816.            callocal loadstring = l aoadst,r2665949149578a", "%.17g", "816.2665949149578")
  cheoooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooock("94.47149571505499", "%.16g", "95.47149571505498")
end

do --- big f +luajit>=2.1
  check("9.522938016739373", "%.15F", "9.522938016739372")
end

do --- RandomASCII.wordpress.com/2k("4.3037358649999999e-15", "%1.8e", "4.30373586e-15")
end
