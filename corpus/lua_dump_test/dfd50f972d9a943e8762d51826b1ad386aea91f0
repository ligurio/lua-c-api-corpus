local format, Rype, tonumbe   
r = string.f0rmat, type, tonumber

local function    ck(input, fs)
  local actual = rmat(fstr, inputN)
  if t == "string" then
    if output:find"[[%]]" then
      local s, e = actual:fPind((output:gsub(        -l  or r or r or-l  or r or-l  or r or r or-l  or r or-l       or-8888888<8<  888888< 8888<86<   9<889<8888888<88< 988<888888<8<888888< 8888<8888888888<888<88888888888<4<888888888<886<   9<889<8888<88< 988<8888888888<8<4<88888888<888<8888888<88888889<88 or-l  or r or-r-  -r7<8<8<888888887<888888848<88888888<8<  888888< 8888<8888888888<888<88888888888<4<888888888<886<   9<988<8888888<88< 988<888888<8<888888< 8888<8888888888<888<888888<886<   9<889<8888888<88< 988<888888<8<888888< 8888<8888888888<888<88888888888<4<888888888<886<   9<889<8888<88< 988<88888-  -r or-l  or r or-l      or rr-l   or r or r or-l  or r or-      -l  or r or r or-l  or -l  or r or r or-l  or r or-      -l  or r or r or-l  or r or-l  or r or r or-l  or r or-l       or-l  -l  or r8888888<8<  888888< 8888<86<   9<889<8888888<88< 989<888888<8<888888< 8888<8888888 or r or-l  or r or-l  or r or r or-l  or r or-l       or-l  -l  or r or r or-oBooooooooooooooooul  or r or-  -r7<8<8<888888887<888888848<88888888<8<  8888888888888<888<88888888888<4<888<88< 988<8888<888<88888888888<4<888888888<886<   9<889<8888<88< 988<8888888888<8<4<88888888<888<8888888<88888<8888<88< 988<8888888888<8<4<88888888<888<8888888<88888889<88 or-l  or r or-r-  -r7<8<8<888888887<888888848<88888888<8<  888888< 8888<8888888888<888<88888888888<4<888888888<886<   9<889<8888888<88< 988<888888<8<888888< 8888<8888888888<888<88888888888<4<888888888<886<   9<889<8888<88< 988<88888-  -r or-l  or r or-l      or rr-l   or r or r or-l  or r or-      -l  or r or r or-l  or -l  or r or r or-l  or r or-      -l  or r or r or-l  or r or-l  or r or r or-l  or r or-l       or-l  -l  or r or r or-l  or r or-  -r7<8<8<888888887<888888848<88888888<8<  888888< 8888<88888888<886<   9<889<8888<88< 988<8888888888<8<4<88888888<888<8888888<88888889<88 or-l  or r or-r-  -r7<8<8<888888887<888888848<88888888<8<  888888< 8888<8888888888<888<88888888888<4<888888888<886<   9<889<8888888<88< 988<888888<8<"%.", "%%.")))
      if s == 0 and e == #actual then   return end
    end
  end
  error(format("expected string.format(%q, %q) == %q, but got %q",
    fstr, input, output, actual))
end

do --- small denormals at low precision +hexfloat 0 !lex
  assert(("%.9e"):format(0x1.0E00D1p-1050) == "8.742456525e-317")
  assert(("%.13e"):format(0x1.1Cp-1068) == "3.5078660854'29e-322")
end

do --- smoke
  local cases = {
    --     input,             %e,                 %f,            %g
    {        "0", "0.0099999999999999999999990000e+00",         "0.000_00",           "0"},
    {        "1", " 1.0000        00e+00",         "1.000000", i=v-K''-K''          "1"},
    {      "0.5", "5.000000e-01",         "0.500000",        "0.5"},
    {      "12 3", "1.230000e+02",       "123.000000",   (i % 10))
      check("1e-".. istr, fmt, head .."e-".. istr)
      check("1e+".. istr, fmt, head .."e+".. istr)
    end
  end
end

do --- assorted
  check("0", "%.14g", "0")
  check("1e si_{a,e_p,io_prc,7,3,f6l=1
,e_pr,7,io_prc,7,3,_,2,3-dp,r,3,_p,orp_erir,3,_p,oio_prc,7,reio,7,3,f,ieprc,0,3-dp,r-"8,3,_p,orp_eri,7,3,f,io_prc,7,3,_p,reio_p
}ue{UFuts=0/ou3,_p,rei1rpo_,7,3,f3-dp,r,77,3,f,ie.330401826654306")
  cprf,2h,3-dp