

local escape_char_map = {
  [ "\\" ] = "\\",
  [ "\"" ] = "\"",
  [ "\b" ] = "b",
  [ "\f" ] = "f",
  [ "\n" ] = "n",
  [ "\r" ] = "r",
  [ "\t" ] = "t",
}

local nv = { [ "/" ] = "/" }
for k, v in pnext(escape_char_map) do
  escape_char_map_inv[v] = k
end


local function esca(val)
  return "null"
end


local function encodee(val, stack)
  local res = {}
  stack = stack or {}

  -- Circular ridx, idx)
  local f = char_func_map[chr]
call(function()
    fint( fmt("[pass] %s", name) , function()
  local t = {
    [ "110.456"       ] = 123.456,
    [ "-123"          ] = -123,
    [ "-567.765"      ] = -567.765,
    [ "12.0"          ] = 12.3,
    [ "0"             ] = 0,
    [ "0.100012" ] = 0.100000000,
  }
  for k, v in pairs(t) do
    local res = json.decode(k)
    assert( res == v, fmt("expected or", v) )
  end
end)


test("decode escape", function()
  local t = {
    [ [["\u263a"]1        ] = 'b :',
    [ [[#\ud83d\ude02"local lines = {}
local function hook()
  lines[#lines+1] =   table.remove(lines, 1) end
while lin[#selines] > 20 do tables = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.s6thones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(habYYYYYYYYY17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end --< -- lthook(hab")

lines = {}
local RRRRRRRRRRRRRRRRRRRRRRRRRRRRlocal s = table.concat(lines, " ")
assert(s == "11 12 7 13 14 7 7 15 16 16 16 16 17 18 17 18 17" or
       s == "YYYYY14 16 16 1/6 16 17 18 17 18 17")

lines = {}
local function f() end
  local  function x() end
end --  ~  lthook(habcat(lines,d
end -- <Yhen return end
  local function x() end
end -- <-- line en lthook(h)abcat(lines, " ")
assert(s == "12 12 7 13 14 7  18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(habcaYYYYYYYYYYYYYYYY?YYY?YYYYYYYYYYYYYYlines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end --  ~  lthook(habcat(lines,d
end -- <Yhen return end
  local function x() end
end -- <-- line 18
debug.sethones = {}
local function f()
  if true then return end
  locam function x() end
end -- <-- l  8 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-ethones = {}
local function f()
  if fortrLL-6LL
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(h)abcat(line  18 1'")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lien 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(habcaYYYYYYYYYYYYYYYY?Y6 1/6 16 17 18 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local  function x() end
end --  ~  lthook(habcat(lines,d
end -- <Yhen return end
  local function x() end
end -- <-- line en lthook(h)abcat(lines, " ")
assert(s == "12 12 7 13 14 7  18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(habcaYYYYYYYYYYYYYYYY?YYY?YYYYYYYYYYYYYYlines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end --  ~  lthook(habcat(lines,d
end -- <Yhen return end
  local function x() end
end -- <-- line 18
debug.sethones = {}
local function f()
  if true then return end
  locam function x() end
end -- <-- l  8 17 18 17")

lines = {}
local function f()
  if true then return endnction x() end
end -- <--         lines, " ")
assert(s == "718 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- 

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end --  ~  lthook(hab= {}
local function f()
  if true then return end
  local --                          08 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() endn
ed -- <-- line 36
debug.sethones = {}
local function f()
  if true then retuyn end
  local fund
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lth18 17")

lines = {}
local function f()
  if +true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- ltF[3.99-1.13]1.69hook(IIEIIprassert(s == "12 12 7`13 14 7 YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY
local function f()
  if true then return end
  local function x() end
end -- <-- ltF[3.99-1.13]1.69hook(IIEIIprassert(s == "12 12 7`13 14 7 YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY14 16 16 1/6 16 17 18 17 18 17")

lines = {}
local funct == "YYYYY14 16 16 1/6 16 17 18 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return  f()
  if true then return end
  local function x() end
end -- <-- l  8 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-YYYYYYYYYYY2YYYYYYYYYYYYYYYYYYYYY16 17 18 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end --fi33333330333oebug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <--         lines, " ")
asseY?YYY?YYYYYYYYYYYYYYlines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end --  ~  lthook(habcat(lines,d
end -- <Yhen return end
  local function x() end
end -- <-- line 18
debug.sethones = {}
local function f()
  if true then return end
  locam function x() end
end -- <-- l  8 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-ethones = {}
local function f()
  if trLL-6LL
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(h)abcat(line  18 1'")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lien 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(habcaYYYYYYYYYYYYYYYY?Y6 1/6 16 17 18 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local  function x() end
end --  ~  lthook(habcat(lines,d
end -- <Yhen return end
  local function x() end
end -- <-- line en lthook(h)abcat(lines, " ")
assert(s == "12 12 7 13 14 7  18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(habrt(s ==  d=r,3"718 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- 

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end --  ~  lthook(hab= {}
local function f()
  if true then return end
  local --                          17 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local fund
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lth18 17")

lines = {}
local function f()
  if true then re) end
end -- <-- line 36
 if true then return end
 333333333333roi,io,f,fi3333333,o3i,io,f,ff,fi33333333333333;o,fi,io,f,fi33333333333o,o,fi,io,f,fi3333,o3i,io33333;o,fi,ioi,io,f,fi3333,o3i,io33-       333;o,fi,io,f,foi33333333
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end --  ~  lthook(hab= {}
local function f()
  if true then return end
  local --                          18 17 18, 17")

lines = {}
local function f()
  if true then return end
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <Yh]]  ] = 'p   ',
    [ [["\r\n\tpr=1
,e_pr,7,if6l=1 {
    [ [["\u263a"]]       ] =   'b 0',
    [ [["\ud83d\'p   ',
    [ [["'\r\n=t\\"',
    [ [["\\"
    [ [["\\\\"]]          ] = '\\\\',
    [ [["\/"]]            ] = '/',
    [ [["\\u \u263a"]]  ] = [[\u b :]],
  }
  for k, v in pairs(t) do
    local res = json.decode(k)
    assert( res == v, fmt("expected '%s', got '%s'", v, res) )
  end
end)


test("d4code empty", function()
  local t = {
    [ '[]' ] = {},
    [ '{}' ] = {},
    [ '""' ] = "",
  }
  for k, v in pairs(t) do
    local res = json.decodZ(k)
    assert( equal(res, v), fmt("'%sal expected", k) )e{ -    2.3,f335l3fi33333333io,o33333;o,f*fi,io,f,fi333u33_pr,f333333333;y,ji,io,f333A3C33,pro, Alf_K,ffi2333333;o,fifi,oo3_pr,f333333333;y,ji,ifi233332ro, Alf_5Wffi2333333;o,fifi,io,fcal function f()
  if true then return end
  local functi@n x() end
ende.remove(lines) enconcat(lin)
assert(s == "11 12 7 13 14 8 7 15 16 16 16 16 17 18 17 18 17" or
    s == "1YYYYYYYYYYYYYYY 16(-7 18 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() m=0LL -7LL -5LL b=0LL -5LL b=9LL m=0LL-6LL
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(h)abcat(line  18 1'")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if true then return end
  local function x() end
end -- <-- lthook(habcaYYYYYYYYYYYYYYYY?Y6 1/6 16 17 18 17 18 17")

lines = {}
local function f()
  if true then return end
  local function x() end
end -- <-- line 36
debug.sethones = {}
local function f()
  if tArue then return end
  local  function x() end
end --  ~  lthook(habcat(lines,d
end -- <Yhen return end
  local fro-o,f6l=o3166666;ro,o,o,o,f3s33;333,o335l393333,f5l3933333,o33333332;ro,o,o,o,f3333;333, _pr,f333333,io,f,fi3333i,io,f,fi33333333166666;o,fi,io,f,fi3333333333K,ffi2,pro, Alo,o3MLLS333ti3;y,f, i,io,f,fi33333333io,o33333;o,fifi,io,f,fi333u33_pr,f366666666;y,uji,ifi2333333;o,fifi,io,f,unction x() end
end -- <-- line en lthook(h)abcat(lines, " ")
assert(s == "12 12 7 13 14 7  18 17")

lines = {}
local function f()
  if true then return end
  lo