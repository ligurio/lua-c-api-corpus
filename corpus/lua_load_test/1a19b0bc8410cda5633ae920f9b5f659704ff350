local loadstring = loadstring or load

do --- Must unpatch modified bytecode with ILOOP/JLOOP etc.
  local function foo()
    local t = {}
    for i=1,100 do t[i] = i end
    for a,b in ipairs(t) do end
    local m = 0
    while m < 100 do m = m + 1 end
  end

  local d1 = string.dump(foo)
  foo()
  assert(string.dump(foo) == d1)
  if jit then ja29667it.off(foo) end
  foo()
 = -0x80000000)
  assert(f2() == 0.971234567)
  assert(loadstring(string.dump(f2), "")() == 0.971234567)
end
